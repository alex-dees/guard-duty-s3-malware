import { 
    S3Client, 
    CopyObjectCommand,
    DeleteObjectCommand 
} from "@aws-sdk/client-s3";
import { Handler } from "aws-lambda";

const client = new S3Client();

export const handler: Handler = async (event) => {
    const {
        objectKey: key,
        bucketName: src
    } = event.detail.s3ObjectDetails;
    const dst = process.env.DST_BUCKET;
    
    // sdk does not have a move command
    const cp = new CopyObjectCommand({
        Key: key,
        Bucket: dst,
        CopySource: `${src}/${key}`
    });
    const rm = new DeleteObjectCommand({
        Key: key,
        Bucket: src
    });

    try {
        console.log(`moving ${key} to ${dst}`);
        await client.send(cp);
        await client.send(rm);
    } catch (e) {
        console.error(e);
    }
}