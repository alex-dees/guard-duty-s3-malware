# GuardDuty S3 Malware

Demonstrates enabling GuardDuty S3 Malware Protection for an S3 bucket.  If malware is detected, a notification will optionally be sent to an SNS topic.

## Install

Follow [instructions](https://docs.aws.amazon.com/cdk/v2/guide/getting_started.html) to install CDK and bootstrap your account.

## Deploy

Set email in cdk.json if you'd like to receive an email notification when a threat is found.

Run `cdk deploy`

## Test

Upload an EICAR test file to S3.

- Temporarily [disable Malware Protection](https://support.microsoft.com/en-us/windows/turn-off-defender-antivirus-protection-in-windows-security-99e6004f-c54c-8509-773c-a4d776b77960)
- Download the [EICAR test file](https://github.com/fire1ce/eicar-standard-antivirus-test-files/blob/master/eicar-test.txt)
- Get the bucket name from CloudFormation stack outputs
- Upload the test file to the bucket

`aws s3 cp eicar-test.txt s3://<bucket>/eicar-test.txt`
- Re-enable Malware Protection

Verify the S3 test file has a GuardDutyMalwareScanStatus tag set to THREATS_FOUND
